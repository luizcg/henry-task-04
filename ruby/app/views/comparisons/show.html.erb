<div class="max-w-4xl mx-auto p-6">
  <div class="flex justify-between items-center mb-6">
    <h1 class="text-3xl font-bold">Comparison #<%= @comparison.id %></h1>
    <%= link_to "Back to list", comparisons_path, class: "text-blue-600 hover:text-blue-800" %>
  </div>

  <% if notice.present? %>
    <div class="bg-green-50 border border-green-200 rounded-lg p-4 mb-6">
      <p class="text-green-800"><%= notice %></p>
    </div>
  <% end %>

  <div class="bg-white shadow rounded-lg p-6 mb-6">
    <div class="grid grid-cols-2 gap-6">
      <div>
        <h3 class="text-sm font-medium text-gray-500">Status</h3>
        <span class="mt-1 px-3 py-1 inline-flex text-sm font-semibold rounded-full <%= status_badge_class(@comparison.status) %>">
          <%= @comparison.status.capitalize %>
        </span>
      </div>
      <div>
        <h3 class="text-sm font-medium text-gray-500">Processing Time</h3>
        <p class="mt-1 text-sm text-gray-900"><%= @comparison.processing_time_ms ? "#{@comparison.processing_time_ms}ms" : "—" %></p>
      </div>
      <div>
        <h3 class="text-sm font-medium text-gray-500">Created</h3>
        <p class="mt-1 text-sm text-gray-900"><%= @comparison.created_at.strftime("%Y-%m-%d %H:%M:%S") %></p>
      </div>
      <div>
        <h3 class="text-sm font-medium text-gray-500">Trace ID</h3>
        <p class="mt-1 text-sm text-gray-900 font-mono"><%= @comparison.trace_id || "—" %></p>
      </div>
    </div>
  </div>

  <% if @comparison.failed? && @comparison.error_message.present? %>
    <div class="bg-red-50 border border-red-200 rounded-lg p-6 mb-6">
      <h3 class="text-lg font-semibold text-red-800 mb-2">Error</h3>
      <p class="text-red-700"><%= @comparison.error_message %></p>
    </div>
  <% end %>

  <% if @comparison.completed? && @comparison.result.present? %>
    <div class="space-y-6">
      <div class="bg-white shadow rounded-lg p-6">
        <h3 class="text-lg font-semibold mb-4">Sections Changed</h3>
        <ul class="list-disc list-inside space-y-1">
          <% @comparison.sections_changed.each do |section| %>
            <li class="text-gray-700"><%= section %></li>
          <% end %>
        </ul>
      </div>

      <div class="bg-white shadow rounded-lg p-6">
        <h3 class="text-lg font-semibold mb-4">Topics Touched</h3>
        <div class="flex flex-wrap gap-2">
          <% @comparison.topics_touched.each do |topic| %>
            <span class="bg-gray-100 text-gray-800 px-3 py-1 rounded-full text-sm"><%= topic %></span>
          <% end %>
        </div>
      </div>

      <div class="bg-white shadow rounded-lg p-6">
        <h3 class="text-lg font-semibold mb-4">Summary of Changes</h3>
        <p class="text-gray-700 whitespace-pre-wrap"><%= @comparison.summary %></p>
      </div>
    </div>
  <% end %>

  <% if @comparison.pending? || @comparison.processing? %>
    <div class="bg-blue-50 border border-blue-200 rounded-lg p-6" data-comparison-id="<%= @comparison.id %>">
      <div class="text-center mb-4">
        <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-4"></div>
        <p class="text-blue-800 font-semibold" id="progress-status">Processing your comparison...</p>
      </div>
      
      <div class="w-full bg-gray-200 rounded-full h-4 mb-4">
        <div id="progress-bar" class="bg-blue-600 h-4 rounded-full transition-all duration-300" style="width: 0%"></div>
      </div>
      
      <div id="progress-message" class="text-blue-600 text-sm text-center"></div>
      
      <div id="progress-log" class="mt-4 text-xs text-gray-600 space-y-1 max-h-40 overflow-y-auto"></div>
    </div>
  <% end %>
</div>
